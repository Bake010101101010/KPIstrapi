
// import { useEffect, useState } from "react";
// import {
//   apiLogin,
//   fetchMe,
//   calcKpiJson,
//   downloadKpiExcel,
//   downloadKpi1C,
//   downloadKpiBuh,
//   downloadBlobAsFile,
//   fetchKpiList,
//   apiAddEmployee,
//   apiEditEmployee,
//   apiDeleteEmployee,
//   fetchDeletedLog,
//   fetchEditedLog,
//   apiRestoreEmployee,
// } from "./api";

// const COLOR_BLUE = "#1f3c88"; // –±–∞–∑–æ–≤—ã–π —Å–∏–Ω–∏–π
// const COLOR_GREEN = "#123524"; // Phthalo green
// const COLOR_BG = "#f4f7fb";
// const COLOR_CARD = "#ffffff";

// const STORAGE_TOKEN_KEY = "nnmc_kpi_token";
// const STORAGE_USER_KEY = "nnmc_kpi_user";
// const STORAGE_TAB_KEY = "nnmc_kpi_tab";

// function App() {
//   const [token, setToken] = useState(null);
//   const [currentUser, setCurrentUser] = useState(null);
//   const [activeTab, setActiveTab] = useState("calc"); // calc | directory

//   const [globalMessage, setGlobalMessage] = useState(null); // {type:"success"|"error", text:""}

//   // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–æ–∫–µ–Ω –∏ —Ç–∞–± –∏–∑ localStorage
//   useEffect(() => {
//     const savedToken = window.localStorage.getItem(STORAGE_TOKEN_KEY);
//     const savedUser = window.localStorage.getItem(STORAGE_USER_KEY);
//     const savedTab = window.localStorage.getItem(STORAGE_TAB_KEY);
//     if (savedToken && savedUser) {
//       try {
//         const userObj = JSON.parse(savedUser);
//         setToken(savedToken);
//         setCurrentUser(userObj);
//       } catch (e) {
//         // ignore
//       }
//     }
//     if (savedTab) {
//       setActiveTab(savedTab);
//     }
//   }, []);

//   // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–∫–µ–Ω, –µ—Å–ª–∏ –æ–Ω –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
//   useEffect(() => {
//     const checkMe = async () => {
//       if (!token) return;
//       try {
//         const me = await fetchMe(token);
//         setCurrentUser({ login: me.login, role: me.role });
//       } catch (e) {
//         handleLogout(true);
//       }
//     };
//     checkMe();
//     // eslint-disable-next-line react-hooks/exhaustive-deps
//   }, [token]);

//   const handleLogout = (silent = false) => {
//     setToken(null);
//     setCurrentUser(null);
//     window.localStorage.removeItem(STORAGE_TOKEN_KEY);
//     window.localStorage.removeItem(STORAGE_USER_KEY);
//     if (!silent) {
//       showMessage("success", "–í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã");
//     }
//   };

//   const showMessage = (type, text) => {
//     setGlobalMessage({ type, text });
//     setTimeout(() => {
//       setGlobalMessage(null);
//     }, 4000);
//   };

//   const handleAuthError = (err) => {
//     if (err.message === "AUTH_REQUIRED") {
//       handleLogout(true);
//       showMessage("error", "–°–µ—Å—Å–∏—è –∏—Å—Ç–µ–∫–ª–∞. –í–æ–π–¥–∏—Ç–µ —Å–Ω–æ–≤–∞.");
//     } else {
//       showMessage("error", err.message || "–û—à–∏–±–∫–∞");
//     }
//   };

//   const handleLoginSuccess = (tok, user) => {
//     setToken(tok);
//     setCurrentUser(user);
//     window.localStorage.setItem(STORAGE_TOKEN_KEY, tok);
//     window.localStorage.setItem(STORAGE_USER_KEY, JSON.stringify(user));
//     showMessage("success", "–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥");
//   };

//   const handleChangeTab = (tab) => {
//     setActiveTab(tab);
//     window.localStorage.setItem(STORAGE_TAB_KEY, tab);
//   };

//   if (!token || !currentUser) {
//     return (
//       <div
//         style={{
//           minHeight: "100vh",
//           background:
//             "radial-gradient(circle at top left, #e0f2fe 0, #f4f7fb 40%, #e5f6ff 100%)",
//           display: "flex",
//           alignItems: "center",
//           justifyContent: "center",
//           padding: 16,
//         }}
//       >
//         <div
//           style={{
//             backgroundColor: COLOR_CARD,
//             padding: 32,
//             borderRadius: 20,
//             boxShadow: "0 20px 45px rgba(15,23,42,0.18)",
//             width: 380,
//             position: "relative",
//           }}
//         >
//           <div style={{ textAlign: "center", marginBottom: 16 }}>
//             <div
//               style={{
//                 width: 80,
//                 height: 80,
//                 borderRadius: 999,
//                 margin: "0 auto 8px",
//                 backgroundColor: "#e0f2fe",
//                 display: "flex",
//                 alignItems: "center",
//                 justifyContent: "center",
//                 overflow: "hidden",
//               }}
//             >
//               {/* –ª–æ–≥–æ—Ç–∏–ø –ù–ù–ú–¶, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Å—Ç–∞–≤–∏—Ç —Ä–µ–∞–ª—å–Ω—É—é –∫–∞—Ä—Ç–∏–Ω–∫—É */}
//               <span style={{ fontSize: 36 }}>üíß</span>
//             </div>
//             <h1 style={{ fontSize: 20, marginBottom: 4, color: COLOR_BLUE }}>
//               NNMC KPI Panel
//             </h1>
//             <p
//               style={{
//                 fontSize: 12,
//                 color: "#6b7280",
//                 margin: 0,
//               }}
//             >
//               –í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–∞–±–µ–ª—è–º–∏ –∏ KPI
//             </p>
//           </div>

//           <LoginForm onLoginSuccess={handleLoginSuccess} />

//           {globalMessage && (
//             <div
//               style={{
//                 marginTop: 12,
//                 fontSize: 13,
//                 textAlign: "center",
//                 color:
//                   globalMessage.type === "error" ? "#b91c1c" : "#047857",
//               }}
//             >
//               {globalMessage.text}
//             </div>
//           )}
//         </div>
//       </div>
//     );
//   }

//   return (
//     <div
//       style={{
//         minHeight: "100vh",
//         background:
//           "linear-gradient(135deg, #e0f2fe 0, #f4f7fb 40%, #e0f2f1 100%)",
//       }}
//     >
//       <header
//         style={{
//           background: `linear-gradient(135deg, ${COLOR_BLUE}, ${COLOR_GREEN})`,
//           color: "white",
//           padding: "12px 20px",
//           display: "flex",
//           alignItems: "center",
//           justifyContent: "space-between",
//         }}
//       >
//         <div style={{ display: "flex", alignItems: "center", gap: 12 }}>
//           <div
//             style={{
//               width: 40,
//               height: 40,
//               borderRadius: 999,
//               backgroundColor: "rgba(255,255,255,0.12)",
//               display: "flex",
//               alignItems: "center",
//               justifyContent: "center",
//               overflow: "hidden",
//               fontSize: 22,
//             }}
//           >
//             üíß
//           </div>
//           <div>
//             <div style={{ fontSize: 17, fontWeight: 600 }}>
//               –ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –ù–∞—É—á–Ω—ã–π –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π –¶–µ–Ω—Ç—Ä ‚Äî KPI
//             </div>
//             <div style={{ fontSize: 11, opacity: 0.95 }}>
//               –†–∞—Å—á—ë—Ç –±–æ–Ω—É—Å–æ–≤ –ø–æ —Ç–∞–±–µ–ª—é –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–º —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
//             </div>
//           </div>
//         </div>
//         <div style={{ display: "flex", alignItems: "center", gap: 14 }}>
//           <div style={{ textAlign: "right", fontSize: 12 }}>
//             <div>{currentUser.login}</div>
//             <div style={{ fontSize: 11, opacity: 0.9 }}>
//               –†–æ–ª—å: {currentUser.role === "admin" ? "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä" : "–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å"}
//             </div>
//           </div>
//           <button
//             onClick={() => handleLogout(false)}
//             style={{
//               padding: "6px 12px",
//               borderRadius: 999,
//               border: "1px solid rgba(255,255,255,0.7)",
//               backgroundColor: "transparent",
//               color: "white",
//               cursor: "pointer",
//               fontSize: 12,
//             }}
//           >
//             –í—ã–π—Ç–∏
//           </button>
//         </div>
//       </header>

//       <main
//         style={{
//           maxWidth: 1260,
//           margin: "16px auto 24px",
//           padding: "0 16px",
//         }}
//       >
//         <div
//           style={{
//             display: "flex",
//             gap: 8,
//             marginBottom: 12,
//             borderBottom: "1px solid #e5e7eb",
//           }}
//         >
//           <TabButton
//             active={activeTab === "calc"}
//             onClick={() => handleChangeTab("calc")}
//           >
//             –†–∞—Å—á—ë—Ç KPI –ø–æ —Ç–∞–±–µ–ª—é
//           </TabButton>
//           <TabButton
//             active={activeTab === "directory"}
//             onClick={() => handleChangeTab("directory")}
//           >
//             –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ / –ò—Å—Ç–æ—Ä–∏—è
//           </TabButton>
//         </div>

//         {globalMessage && (
//           <div
//             style={{
//               marginBottom: 10,
//               padding: "8px 10px",
//               borderRadius: 10,
//               fontSize: 13,
//               backgroundColor:
//                 globalMessage.type === "error" ? "#fee2e2" : "#dcfce7",
//               color:
//                 globalMessage.type === "error" ? "#b91c1c" : "#166534",
//             }}
//           >
//             {globalMessage.text}
//           </div>
//         )}

//         {activeTab === "calc" && (
//           <CalcPage
//             token={token}
//             onAuthError={handleAuthError}
//             onMessage={showMessage}
//           />
//         )}

//         {activeTab === "directory" && (
//           <DirectoryPage
//             token={token}
//             currentUser={currentUser}
//             onAuthError={handleAuthError}
//             onMessage={showMessage}
//           />
//         )}
//       </main>
//     </div>
//   );
// }

// function TabButton({ active, onClick, children }) {
//   return (
//     <button
//       onClick={onClick}
//       style={{
//         padding: "8px 16px",
//         borderRadius: 999,
//         border: "none",
//         fontSize: 13,
//         cursor: "pointer",
//         backgroundColor: active ? COLOR_BLUE : "transparent",
//         color: active ? "white" : "#374151",
//         boxShadow: active ? "0 4px 10px rgba(0,0,0,0.15)" : "none",
//         transform: active ? "translateY(-1px)" : "none",
//       }}
//     >
//       {children}
//     </button>
//   );
// }

// function LoginForm({ onLoginSuccess }) {
//   const [login, setLogin] = useState("");
//   const [password, setPassword] = useState("");
//   const [loading, setLoading] = useState(false);
//   const [localError, setLocalError] = useState("");

//   const handleSubmit = async (e) => {
//     e.preventDefault();
//     setLocalError("");

//     if (!login.trim() || !password.trim()) {
//       setLocalError("–£–∫–∞–∂–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å.");
//       return;
//     }

//     try {
//       setLoading(true);
//       const data = await apiLogin({ login, password });
//       onLoginSuccess(data.token, { login: data.login, role: data.role });
//     } catch (err) {
//       setLocalError(err.message || "–û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏");
//     } finally {
//       setLoading(false);
//     }
//   };

//   return (
//     <form
//       onSubmit={handleSubmit}
//       style={{ display: "grid", gap: 10, marginTop: 6 }}
//     >
//       <div>
//         <label
//           style={{
//             display: "block",
//             fontSize: 13,
//             marginBottom: 4,
//           }}
//         >
//           –õ–æ–≥–∏–Ω
//         </label>
//         <input
//           type="text"
//           value={login}
//           onChange={(e) => setLogin(e.target.value)}
//           style={{
//             width: "100%",
//             padding: "8px 10px",
//             borderRadius: 8,
//             border: "1px solid #d1d5db",
//             fontSize: 13,
//           }}
//         />
//       </div>
//       <div>
//         <label
//           style={{
//             display: "block",
//             fontSize: 13,
//             marginBottom: 4,
//           }}
//         >
//           –ü–∞—Ä–æ–ª—å
//         </label>
//         <input
//           type="password"
//           value={password}
//           autoComplete="current-password"
//           onChange={(e) => setPassword(e.target.value)}
//           style={{
//             width: "100%",
//             padding: "8px 10px",
//             borderRadius: 8,
//             border: "1px solid #d1d5db",
//             fontSize: 13,
//           }}
//         />
//       </div>
//       {localError && (
//         <div style={{ fontSize: 12, color: "#b91c1c" }}>{localError}</div>
//       )}
//       <button
//         type="submit"
//         disabled={loading}
//         style={{
//           marginTop: 4,
//           padding: "8px 12px",
//           borderRadius: 999,
//           border: "none",
//           background: `linear-gradient(135deg, ${COLOR_BLUE}, ${COLOR_GREEN})`,
//           color: "white",
//           fontSize: 13,
//           fontWeight: 500,
//           cursor: loading ? "default" : "pointer",
//         }}
//       >
//         {loading ? "–í—Ö–æ–¥–∏–º..." : "–í–æ–π—Ç–∏"}
//       </button>
//     </form>
//   );
// }

// // ======== CalcPage =========

// function CalcPage({ token, onAuthError, onMessage }) {
//   const now = new Date();
//   const [timesheetFile, setTimesheetFile] = useState(null);
//   const [nchDay, setNchDay] = useState("");
//   const [ndShift, setNdShift] = useState("");
//   const [year, setYear] = useState(now.getFullYear());
//   const [month, setMonth] = useState(now.getMonth() + 1);
//   const [loading, setLoading] = useState(false);
//   const [error, setError] = useState("");
//   const [results, setResults] = useState([]);
//   const [errorsList, setErrorsList] = useState([]);

//   const hasResults = results && results.length > 0;

//   const baseArgs = {
//     token,
//     timesheetExcel: timesheetFile,
//     nchDay: nchDay || 0,
//     ndShift: ndShift || 0,
//     year,
//     month,
//   };

//   const handleSubmit = async (e) => {
//     e.preventDefault();
//     setError("");
//     setResults([]);
//     setErrorsList([]);

//     if (!timesheetFile) {
//       setError("–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª —Ç–∞–±–µ–ª—è.");
//       return;
//     }
//     if (!nchDay && !ndShift) {
//       setError("–£–∫–∞–∂–∏—Ç–µ –ù.—á –¥–ª—è –¥–Ω–µ–≤–Ω—ã—Ö –∏/–∏–ª–∏ –ù.–¥ –¥–ª—è —Å—É—Ç–æ—á–Ω—ã—Ö.");
//       return;
//     }
//     if (!year || !month) {
//       setError("–£–∫–∞–∂–∏—Ç–µ –≥–æ–¥ –∏ –º–µ—Å—è—Ü.");
//       return;
//     }

//     try {
//       setLoading(true);
//       const data = await calcKpiJson(baseArgs);
//       setResults(data.results || []);
//       setErrorsList(data.errors || []);
//       onMessage("success", "–†–∞—Å—á—ë—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∫–∞–∑–∞–Ω—ã –Ω–∏–∂–µ.");
//     } catch (err) {
//       if (err.message === "AUTH_REQUIRED") {
//         onAuthError(err);
//       } else {
//         setError(err.message || "–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—á—ë—Ç–µ KPI.");
//       }
//     } finally {
//       setLoading(false);
//     }
//   };

//   const handleDownload = async (mode) => {
//     if (!timesheetFile) {
//       setError("–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª —Ç–∞–±–µ–ª—è –∏ –ø–æ—Å—á–∏—Ç–∞–π—Ç–µ KPI.");
//       return;
//     }
//     if (!hasResults) {
//       setError("–°–Ω–∞—á–∞–ª–∞ –ø–æ—Å—á–∏—Ç–∞–π—Ç–µ KPI (–∫–Ω–æ–ø–∫–∞ –≤—ã—à–µ).");
//       return;
//     }

//     setError("");
//     try {
//       setLoading(true);
//       let blob;
//       let filename;
//       if (mode === "excel") {
//         blob = await downloadKpiExcel(baseArgs);
//         filename = "KPIfinal.xlsx";
//       } else if (mode === "1c") {
//         blob = await downloadKpi1C(baseArgs);
//         filename = "KPI_for_1C.xlsx";
//       } else if (mode === "buh") {
//         blob = await downloadKpiBuh(baseArgs);
//         filename = "KPI_for_Buh.xlsx";
//       } else {
//         return;
//       }
//       downloadBlobAsFile(blob, filename);
//       onMessage("success", "–§–∞–π–ª —É—Å–ø–µ—à–Ω–æ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω –∏ —Å–∫–∞—á–∞–Ω.");
//     } catch (err) {
//       if (err.message === "AUTH_REQUIRED") {
//         onAuthError(err);
//       } else {
//         setError(err.message || "–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏ —Ñ–∞–π–ª–∞.");
//       }
//     } finally {
//       setLoading(false);
//     }
//   };

//   return (
//     <div
//       style={{
//         backgroundColor: COLOR_CARD,
//         borderRadius: 16,
//         padding: 20,
//         boxShadow: "0 8px 20px rgba(0,0,0,0.06)",
//       }}
//     >
//       <h2 style={{ fontSize: 18, marginBottom: 8, color: COLOR_BLUE }}>
//         –†–∞—Å—á—ë—Ç KPI –ø–æ —Ç–∞–±–µ–ª—é
//       </h2>
//       <p style={{ fontSize: 12, color: "#6b7280", marginTop: 0 }}>
//         –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ç–∞–±–µ–ª—å –∑–∞ –º–µ—Å—è—Ü, —É–∫–∞–∂–∏—Ç–µ –Ω–æ—Ä–º–∞—Ç–∏–≤—ã –ù.—á / –ù.–¥ –∏ –Ω–∞–∂–º–∏—Ç–µ
//         &laquo;–†–∞—Å—Å—á–∏—Ç–∞—Ç—å&raquo;. –ù–∏–∂–µ –ø–æ—è–≤—è—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è –≤—Å–µ—Ö
//         —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤.
//       </p>

//       <form
//         onSubmit={handleSubmit}
//         style={{ display: "grid", gap: 12, marginBottom: 18 }}
//       >
//         <div>
//           <label style={{ display: "block", marginBottom: 4, fontSize: 13 }}>
//             –¢–∞–±–µ–ª—å (Excel):
//           </label>
//           <input
//             type="file"
//             accept=".xlsx,.xls"
//             onChange={(e) => setTimesheetFile(e.target.files[0] || null)}
//             style={{ fontSize: 13 }}
//           />
//         </div>

//         <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 12 }}>
//           <div>
//             <label style={{ display: "block", marginBottom: 4, fontSize: 13 }}>
//               –ù.—á –¥–ª—è –¥–Ω–µ–≤–Ω—ã—Ö (–∫–æ–ª-–≤–æ —Ä–∞–±–æ—á–∏—Ö –¥–Ω–µ–π –≤ –º–µ—Å—è—Ü–µ):
//             </label>
//             <input
//               type="number"
//               value={nchDay}
//               onChange={(e) => setNchDay(e.target.value)}
//               placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 21"
//               style={{
//                 width: "100%",
//                 padding: 6,
//                 fontSize: 13,
//                 borderRadius: 8,
//                 border: "1px solid #d1d5db",
//               }}
//             />
//           </div>
//           <div>
//             <label style={{ display: "block", marginBottom: 4, fontSize: 13 }}>
//               –ù.–¥ –¥–ª—è —Å—É—Ç–æ—á–Ω—ã—Ö (–∫–æ–ª-–≤–æ —Å—É—Ç–æ—á–Ω—ã—Ö —Å–º–µ–Ω –≤ –º–µ—Å—è—Ü–µ):
//             </label>
//             <input
//               type="number"
//               value={ndShift}
//               onChange={(e) => setNdShift(e.target.value)}
//               placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, 7"
//               style={{
//                 width: "100%",
//                 padding: 6,
//                 fontSize: 13,
//                 borderRadius: 8,
//                 border: "1px solid #d1d5db",
//               }}
//             />
//           </div>
//         </div>

//         <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 12 }}>
//           <div>
//             <label style={{ display: "block", marginBottom: 4, fontSize: 13 }}>
//               –ì–æ–¥:
//             </label>
//             <input
//               type="number"
//               value={year}
//               onChange={(e) => setYear(Number(e.target.value))}
//               style={{
//                 width: "100%",
//                 padding: 6,
//                 fontSize: 13,
//                 borderRadius: 8,
//                 border: "1px solid #d1d5db",
//               }}
//             />
//           </div>
//           <div>
//             <label style={{ display: "block", marginBottom: 4, fontSize: 13 }}>
//               –ú–µ—Å—è—Ü (1‚Äì12):
//             </label>
//             <input
//               type="number"
//               min={1}
//               max={12}
//               value={month}
//               onChange={(e) => setMonth(Number(e.target.value))}
//               style={{
//                 width: "100%",
//                 padding: 6,
//                 fontSize: 13,
//                 borderRadius: 8,
//                 border: "1px solid #d1d5db",
//               }}
//             />
//           </div>
//         </div>

//         {error && (
//           <div style={{ color: "#b91c1c", fontSize: 13 }}>{error}</div>
//         )}

//         <div style={{ display: "flex", flexWrap: "wrap", gap: 10, marginTop: 8 }}>
//           <button
//             type="submit"
//             disabled={loading}
//             style={{
//               padding: "8px 14px",
//               backgroundColor: COLOR_BLUE,
//               color: "white",
//               border: "none",
//               borderRadius: 999,
//               cursor: loading ? "default" : "pointer",
//               fontSize: 13,
//             }}
//           >
//             {loading ? "–°—á–∏—Ç–∞–µ–º..." : "–†–∞—Å—Å—á–∏—Ç–∞—Ç—å –∏ –ø–æ–∫–∞–∑–∞—Ç—å"}
//           </button>

//           <button
//             type="button"
//             disabled={loading || !hasResults}
//             onClick={() => handleDownload("excel")}
//             style={{
//               padding: "8px 14px",
//               backgroundColor: "#10b981",
//               color: "white",
//               border: "none",
//               borderRadius: 999,
//               cursor: loading || !hasResults ? "default" : "pointer",
//               fontSize: 13,
//             }}
//           >
//             –°–∫–∞—á–∞—Ç—å –æ–±—â–∏–π Excel
//           </button>

//           <button
//             type="button"
//             disabled={loading || !hasResults}
//             onClick={() => handleDownload("1c")}
//             style={{
//               padding: "8px 14px",
//               backgroundColor: "#f97316",
//               color: "white",
//               border: "none",
//               borderRadius: 999,
//               cursor: loading || !hasResults ? "default" : "pointer",
//               fontSize: 13,
//             }}
//           >
//             –°–∫–∞—á–∞—Ç—å –¥–ª—è 1–°
//           </button>

//           <button
//             type="button"
//             disabled={loading || !hasResults}
//             onClick={() => handleDownload("buh")}
//             style={{
//               padding: "8px 14px",
//               backgroundColor: "#7c3aed",
//               color: "white",
//               border: "none",
//               borderRadius: 999,
//               cursor: loading || !hasResults ? "default" : "pointer",
//               fontSize: 13,
//             }}
//           >
//             –°–∫–∞—á–∞—Ç—å –¥–ª—è –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏–∏
//           </button>
//         </div>
//       </form>

//       {results.length > 0 && (
//         <div>
//           <h3 style={{ fontSize: 16, marginBottom: 8, color: COLOR_BLUE }}>
//             –†–µ–∑—É–ª—å—Ç–∞—Ç—ã KPI
//           </h3>
//           <div
//             style={{
//               maxHeight: 420,
//               overflow: "auto",
//               border: "1px solid #e5e7eb",
//               borderRadius: 8,
//             }}
//           >
//             <table
//               style={{
//                 width: "100%",
//                 borderCollapse: "collapse",
//                 fontSize: 12,
//               }}
//             >
//               <thead>
//                 <tr style={{ backgroundColor: "#e5edf8" }}>
//                   <th style={thStyle}>–§–ò–û</th>
//                   <th style={thStyle}>–ì—Ä–∞—Ñ–∏–∫</th>
//                   <th style={thStyle}>–ù.—á / –ù.–¥</th>
//                   <th style={thStyle}>–§.–≤ / WorkRate</th>
//                   <th style={thStyle}>–ù.–æ</th>
//                   <th style={thStyle}>% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</th>
//                   <th style={thStyle}>KPI —Å—É–º–º</th>
//                   <th style={thStyle}>KPI –∏—Ç–æ–≥</th>
//                   <th style={thStyle}>–ë—É–∫–≤ –±—É–¥–Ω–∏</th>
//                   <th style={thStyle}>–ë—É–∫–≤ —Å—É–±–±–æ—Ç–∞</th>
//                   <th style={thStyle}>–ë—É–∫–≤ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ</th>
//                   <th style={thStyle}>–ß–∏—Å–µ–ª –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ</th>
//                 </tr>
//               </thead>
//               <tbody>
//                 {results.map((row, idx) => (
//                   <tr key={idx} style={{ borderTop: "1px solid #e5e7eb" }}>
//                     <td style={tdStyle}>{row.fio}</td>
//                     <td style={tdStyle}>{row.scheduleType}</td>
//                     <td style={tdStyle}>{row.daysAssigned}</td>
//                     <td style={tdStyle}>{row.daysWorked}</td>
//                     <td style={tdStyle}>{row.notWorked}</td>
//                     <td style={tdStyle}>{row.workPercent}</td>
//                     <td style={tdStyle}>{row.kpiSum}</td>
//                     <td style={tdStyle}>{row.kpiFinal}</td>
//                     <td style={tdStyle}>{row.lettersWeekday}</td>
//                     <td style={tdStyle}>{row.lettersSat}</td>
//                     <td style={tdStyle}>{row.lettersSun}</td>
//                     <td style={tdStyle}>{row.numbersSun}</td>
//                   </tr>
//                 ))}
//               </tbody>
//             </table>
//           </div>
//         </div>
//       )}

//       {errorsList.length > 0 && (
//         <div style={{ marginTop: 16 }}>
//           <h3
//             style={{ fontSize: 15, marginBottom: 4, color: "#b91c1c" }}
//           >
//             –û—à–∏–±–∫–∏ / –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
//           </h3>
//           <ul style={{ fontSize: 12, paddingLeft: 18 }}>
//             {errorsList.map((err, idx) => (
//               <li key={idx}>
//                 <strong>{err.fio}:</strong> {err.type} ‚Äî {err.details}
//               </li>
//             ))}
//           </ul>
//         </div>
//       )}
//     </div>
//   );
// }

// // ===== DirectoryPage + logs & restore =====

// function DirectoryPage({ token, currentUser, onAuthError, onMessage }) {
//   const [items, setItems] = useState([]);
//   const [filteredItems, setFilteredItems] = useState([]);
//   const [loading, setLoading] = useState(false);
//   const [error, setError] = useState("");

//   const [search, setSearch] = useState("");
//   const [filterSchedule, setFilterSchedule] = useState("all");
//   const [filterDepartment, setFilterDepartment] = useState("");
//   const [sortBy, setSortBy] = useState("fio"); // fio | id

//   const [showAddModal, setShowAddModal] = useState(false);
//   const [addForm, setAddForm] = useState({
//     fio: "",
//     kpiSum: 11000,
//     scheduleType: "day",
//     department: "",
//     categoryCode: "",
//   });
//   const [addConfirmMode, setAddConfirmMode] = useState(false);

//   const [editItem, setEditItem] = useState(null);
//   const [editForm, setEditForm] = useState(null);

//   const [deleteItem, setDeleteItem] = useState(null);
//   const [deleteReason, setDeleteReason] = useState("—É–≤–æ–ª–∏–ª—Å—è");
//   const [deleteOther, setDeleteOther] = useState("");

//   const [activeSubTab, setActiveSubTab] = useState("current"); // current | deleted | edited

//   const [deletedLog, setDeletedLog] = useState([]);
//   const [editedLog, setEditedLog] = useState([]);
//   const [loadingLogs, setLoadingLogs] = useState(false);

//   const isAdmin = currentUser.role === "admin";

//   const applyFilters = (list, s, sched, dept, sort) => {
//     let res = list.filter((it) => {
//       const fio = (it.fio || "").toLowerCase();
//       const dep = (it.department || "").toLowerCase();
//       const schedType = (it.scheduleType || "").toLowerCase();

//       if (s && !fio.includes(s.toLowerCase())) {
//         return false;
//       }
//       if (sched !== "all") {
//         if (sched === "day" && schedType !== "day") return false;
//         if (sched === "shift" && schedType !== "shift") return false;
//       }
//       if (dept && !dep.includes(dept.toLowerCase())) {
//         return false;
//       }
//       return true;
//     });

//     if (sort === "fio") {
//       res = res.sort((a, b) =>
//         (a.fio || "").localeCompare(b.fio || "", "ru")
//       );
//     } else if (sort === "id") {
//       res = res.sort((a, b) => (a.id || 0) - (b.id || 0));
//     }

//     return res;
//   };

//   const reload = async () => {
//     setError("");
//     try {
//       setLoading(true);
//       const list = await fetchKpiList(token);
//       setItems(list);
//       setFilteredItems(
//         applyFilters(list, search, filterSchedule, filterDepartment, sortBy)
//       );
//     } catch (err) {
//       if (err.message === "AUTH_REQUIRED") {
//         onAuthError(err);
//       } else {
//         setError(err.message || "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞");
//       }
//     } finally {
//       setLoading(false);
//     }
//   };

//   const reloadLogs = async () => {
//     setLoadingLogs(true);
//     try {
//       const [d, e] = await Promise.all([
//         fetchDeletedLog(token),
//         fetchEditedLog(token),
//       ]);
//       setDeletedLog(d);
//       setEditedLog(e);
//     } catch (err) {
//       if (err.message === "AUTH_REQUIRED") {
//         onAuthError(err);
//       } else {
//         onMessage("error", err.message || "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏");
//       }
//     } finally {
//       setLoadingLogs(false);
//     }
//   };

//   useEffect(() => {
//     reload();
//     reloadLogs();
//     // eslint-disable-next-line react-hooks/exhaustive-deps
//   }, [token]);

//   useEffect(() => {
//     setFilteredItems(
//       applyFilters(items, search, filterSchedule, filterDepartment, sortBy)
//     );
//     // eslint-disable-next-line react-hooks/exhaustive-deps
//   }, [items, search, filterSchedule, filterDepartment, sortBy]);

//   const handleAddSubmit = () => {
//     if (!addForm.fio.trim()) {
//       setError(
//         "–£–∫–∞–∂–∏—Ç–µ –§–ò–û —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ (–∫–∞–∫ –≤ —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–∏ –ª–∏—á–Ω–æ—Å—Ç–∏ –∏–ª–∏ –≤ 1–°)."
//       );
//       return;
//     }
//     if (!addForm.department.trim()) {
//       setError("–£–∫–∞–∂–∏—Ç–µ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞.");
//       return;
//     }
//     if (!addForm.kpiSum || addForm.kpiSum <= 0) {
//       setError("–£–∫–∞–∂–∏—Ç–µ KPI —Å—É–º–º –≤ —Ç–µ–Ω–≥–µ.");
//       return;
//     }

//     setError("");
//     setAddConfirmMode(true);
//   };

//   const handleAddConfirm = async () => {
//     try {
//       const payload = {
//         fio: addForm.fio,
//         kpiSum: addForm.kpiSum,
//         scheduleType: addForm.scheduleType,
//         department: addForm.department,
//         categoryCode: addForm.categoryCode,
//       };
//       const resp = await apiAddEmployee(token, payload);
//       onMessage("success", resp.message || "–°–æ—Ç—Ä—É–¥–Ω–∏–∫ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω");
//       setShowAddModal(false);
//       setAddConfirmMode(false);
//       setAddForm({
//         fio: "",
//         kpiSum: 11000,
//         scheduleType: "day",
//         department: "",
//         categoryCode: "",
//       });
//       await reload();
//     } catch (err) {
//       if (err.message === "AUTH_REQUIRED") {
//         onAuthError(err);
//       } else {
//         setError(err.message || "–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞");
//       }
//     }
//   };

//   const handleEditClick = (item) => {
//     setEditItem(item);
//     setEditForm({
//       id: item.id,
//       fio: item.fio,
//       kpiSum: item.kpiSum,
//       scheduleType: item.scheduleType,
//       department: item.department,
//       categoryCode: item.categoryCode,
//     });
//   };

//   const handleEditSave = async () => {
//     if (!editForm) return;
//     if (!editForm.fio.trim()) {
//       setError("–§–ò–û –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º.");
//       return;
//     }
//     if (!editForm.department.trim()) {
//       setError("–û—Ç–¥–µ–ª–µ–Ω–∏–µ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º.");
//       return;
//     }

//     try {
//       const payload = {
//         id: editForm.id,
//         fio: editForm.fio,
//         department: editForm.department,
//         scheduleType: editForm.scheduleType,
//         categoryCode: editForm.categoryCode,
//       };
//       if (isAdmin) {
//         payload.kpiSum = editForm.kpiSum;
//       }
//       const resp = await apiEditEmployee(token, payload);
//       onMessage(
//         "success",
//         resp.message || "–î–∞–Ω–Ω—ã–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã"
//       );
//       setEditItem(null);
//       setEditForm(null);
//       await reload();
//       await reloadLogs();
//     } catch (err) {
//       if (err.message === "AUTH_REQUIRED") {
//         onAuthError(err);
//       } else {
//         setError(err.message || "–û—à–∏–±–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è");
//       }
//     }
//   };

//   const handleDeleteClick = (item) => {
//     setDeleteItem(item);
//     setDeleteReason("—É–≤–æ–ª–∏–ª—Å—è");
//     setDeleteOther("");
//   };

//   const handleDeleteConfirm = async () => {
//     if (!deleteItem) return;
//     let reason = deleteReason;
//     if (reason === "–¥—Ä—É–≥–æ–µ") {
//       reason = deleteOther || "–¥—Ä—É–≥–æ–µ";
//     }

//     try {
//       const resp = await apiDeleteEmployee(token, {
//         id: deleteItem.id,
//         reason,
//       });
//       onMessage("success", resp.message || "–°–æ—Ç—Ä—É–¥–Ω–∏–∫ —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª—ë–Ω");
//       setDeleteItem(null);
//       setDeleteReason("—É–≤–æ–ª–∏–ª—Å—è");
//       setDeleteOther("");
//       await reload();
//       await reloadLogs();
//     } catch (err) {
//       if (err.message === "AUTH_REQUIRED") {
//         onAuthError(err);
//       } else {
//         setError(err.message || "–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è");
//       }
//     }
//   };

//   const handleRestore = async (logRow) => {
//     try {
//       const payload = {
//         fio: logRow.fio,
//         kpiSum: logRow.kpiSum,
//         scheduleType: logRow.scheduleType,
//         department: logRow.department,
//         categoryCode: logRow.categoryCode,
//         deleted_timestamp: logRow.timestamp,
//         deleted_by: logRow.user,
//         deleted_reason: logRow.reason,
//       };
//       const resp = await apiRestoreEmployee(token, payload);
//       onMessage("success", resp.message || "–°–æ—Ç—Ä—É–¥–Ω–∏–∫ —É—Å–ø–µ—à–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω");
//       await reload();
//       await reloadLogs();
//     } catch (err) {
//       if (err.message === "AUTH_REQUIRED") {
//         onAuthError(err);
//       } else {
//         setError(err.message || "–û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è");
//       }
//     }
//   };

//   return (
//     <div
//       style={{
//         backgroundColor: COLOR_CARD,
//         borderRadius: 16,
//         padding: 20,
//         boxShadow: "0 8px 20px rgba(0,0,0,0.06)",
//       }}
//     >
//       <div
//         style={{
//           display: "flex",
//           justifyContent: "space-between",
//           marginBottom: 12,
//           gap: 12,
//           alignItems: "center",
//         }}
//       >
//         <div>
//           <h2 style={{ fontSize: 18, marginBottom: 4, color: COLOR_BLUE }}>
//             –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ KPI
//           </h2>
//           <p style={{ fontSize: 12, color: "#6b7280", margin: 0 }}>
//             –î–æ–±–∞–≤–ª–µ–Ω–∏–µ, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤.
//             –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø–∏—à—É—Ç—Å—è –≤ Excel-–ª–æ–≥–∏.
//           </p>
//         </div>
//         <button
//           type="button"
//           onClick={() => {
//             setShowAddModal(true);
//             setAddConfirmMode(false);
//           }}
//           style={{
//             height: 34,
//             padding: "6px 12px",
//             borderRadius: 999,
//             border: "none",
//             backgroundColor: COLOR_GREEN,
//             color: "white",
//             fontSize: 13,
//             cursor: "pointer",
//           }}
//         >
//           + –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
//         </button>
//       </div>

//       {error && (
//         <div style={{ marginBottom: 8, color: "#b91c1c", fontSize: 13 }}>
//           {error}
//         </div>
//       )}

//       <div
//         style={{
//           display: "flex",
//           gap: 8,
//           marginBottom: 10,
//           fontSize: 13,
//         }}
//       >
//         <button
//           type="button"
//           onClick={() => setActiveSubTab("current")}
//           style={{
//             ...subTabBtnStyle,
//             ...(activeSubTab === "current" ? subTabBtnActive : {}),
//           }}
//         >
//           –¢–µ–∫—É—â–∏–π —Å–ø–∏—Å–æ–∫
//         </button>
//         <button
//           type="button"
//           onClick={() => setActiveSubTab("deleted")}
//           style={{
//             ...subTabBtnStyle,
//             ...(activeSubTab === "deleted" ? subTabBtnActive : {}),
//           }}
//         >
//           –£–¥–∞–ª—ë–Ω–Ω—ã–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏
//         </button>
//         <button
//           type="button"
//           onClick={() => setActiveSubTab("edited")}
//           style={{
//             ...subTabBtnStyle,
//             ...(activeSubTab === "edited" ? subTabBtnActive : {}),
//           }}
//         >
//           –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
//         </button>
//       </div>

//       {activeSubTab === "current" && (
//         <>
//           <div
//             style={{
//               display: "grid",
//               gridTemplateColumns: "2fr 1fr 1fr 1fr",
//               gap: 8,
//               marginBottom: 12,
//               fontSize: 13,
//             }}
//           >
//             <input
//               placeholder="–ü–æ–∏—Å–∫ –ø–æ –§–ò–û..."
//               value={search}
//               onChange={(e) => setSearch(e.target.value)}
//               style={{
//                 padding: 6,
//                 borderRadius: 8,
//                 border: "1px solid #d1d5db",
//               }}
//             />
//             <select
//               value={filterSchedule}
//               onChange={(e) => setFilterSchedule(e.target.value)}
//               style={{
//                 padding: 6,
//                 borderRadius: 8,
//                 border: "1px solid #d1d5db",
//               }}
//             >
//               <option value="all">–í—Å–µ –≥—Ä–∞—Ñ–∏–∫–∏</option>
//               <option value="day">–¢–æ–ª—å–∫–æ –¥–Ω–µ–≤–Ω—ã–µ</option>
//               <option value="shift">–¢–æ–ª—å–∫–æ —Å—É—Ç–æ—á–Ω—ã–µ</option>
//             </select>
//             <input
//               placeholder="–§–∏–ª—å—Ç—Ä –ø–æ –æ—Ç–¥–µ–ª–µ–Ω–∏—é..."
//               value={filterDepartment}
//               onChange={(e) => setFilterDepartment(e.target.value)}
//               style={{
//                 padding: 6,
//                 borderRadius: 8,
//                 border: "1px solid #d1d5db",
//               }}
//             />
//             <select
//               value={sortBy}
//               onChange={(e) => setSortBy(e.target.value)}
//               style={{
//                 padding: 6,
//                 borderRadius: 8,
//                 border: "1px solid #d1d5db",
//               }}
//             >
//               <option value="fio">–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ –§–ò–û</option>
//               <option value="id">–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ ID</option>
//             </select>
//           </div>

//           <div
//             style={{
//               maxHeight: 420,
//               overflow: "auto",
//               border: "1px solid #e5e7eb",
//               borderRadius: 8,
//             }}
//           >
//             <table
//               style={{
//                 width: "100%",
//                 borderCollapse: "collapse",
//                 fontSize: 12,
//               }}
//             >
//               <thead>
//                 <tr style={{ backgroundColor: "#e5edf8" }}>
//                   <th style={thStyle}>ID</th>
//                   <th style={thStyle}>–§–ò–û</th>
//                   <th style={thStyle}>KPI —Å—É–º–º</th>
//                   <th style={thStyle}>–ì—Ä–∞—Ñ–∏–∫</th>
//                   <th style={thStyle}>–û—Ç–¥–µ–ª</th>
//                   <th style={thStyle}>–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
//                   <th style={thStyle}>–î–µ–π—Å—Ç–≤–∏—è</th>
//                 </tr>
//               </thead>
//               <tbody>
//                 {filteredItems.map((it) => (
//                   <tr key={it.id} style={{ borderTop: "1px solid #e5e7eb" }}>
//                     <td style={tdStyle}>{it.id}</td>
//                     <td style={tdStyle}>{it.fio}</td>
//                     <td style={tdStyle}>{it.kpiSum}</td>
//                     <td style={tdStyle}>{it.scheduleType}</td>
//                     <td style={tdStyle}>{it.department}</td>
//                     <td style={tdStyle}>{it.categoryCode}</td>
//                     <td style={{ ...tdStyle, whiteSpace: "nowrap" }}>
//                       <button
//                         type="button"
//                         onClick={() => handleEditClick(it)}
//                         style={actionBtnStyle}
//                       >
//                         –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
//                       </button>
//                       <button
//                         type="button"
//                         onClick={() => handleDeleteClick(it)}
//                         style={{
//                           ...actionBtnStyle,
//                           backgroundColor: "#fee2e2",
//                           color: "#b91c1c",
//                         }}
//                       >
//                         –£–¥–∞–ª–∏—Ç—å
//                       </button>
//                     </td>
//                   </tr>
//                 ))}
//                 {filteredItems.length === 0 && !loading && (
//                   <tr>
//                     <td style={{ ...tdStyle, padding: 12 }} colSpan={7}>
//                       –°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.
//                     </td>
//                   </tr>
//                 )}
//               </tbody>
//             </table>
//           </div>

//           {loading && (
//             <div
//               style={{
//                 marginTop: 8,
//                 fontSize: 12,
//                 color: "#6b7280",
//               }}
//             >
//               –ó–∞–≥—Ä—É–∑–∫–∞...
//             </div>
//           )}
//         </>
//       )}

//       {activeSubTab === "deleted" && (
//         <div
//           style={{
//             marginTop: 4,
//             maxHeight: 420,
//             overflow: "auto",
//             border: "1px solid #e5e7eb",
//             borderRadius: 8,
//           }}
//         >
//           <table
//             style={{
//               width: "100%",
//               borderCollapse: "collapse",
//               fontSize: 12,
//             }}
//           >
//             <thead>
//               <tr style={{ backgroundColor: "#fee2e2" }}>
//                 <th style={thStyle}>–ö–æ–≥–¥–∞ —É–¥–∞–ª—ë–Ω</th>
//                 <th style={thStyle}>–ö—Ç–æ —É–¥–∞–ª–∏–ª</th>
//                 <th style={thStyle}>–§–ò–û</th>
//                 <th style={thStyle}>KPI —Å—É–º–º</th>
//                 <th style={thStyle}>–ì—Ä–∞—Ñ–∏–∫</th>
//                 <th style={thStyle}>–û—Ç–¥–µ–ª</th>
//                 <th style={thStyle}>–ü—Ä–∏—á–∏–Ω–∞</th>
//                 <th style={thStyle}>–î–µ–π—Å—Ç–≤–∏–µ</th>
//               </tr>
//             </thead>
//             <tbody>
//               {deletedLog.map((row, idx) => (
//                 <tr key={idx} style={{ borderTop: "1px solid #e5e7eb" }}>
//                   <td style={tdStyle}>{row.timestamp}</td>
//                   <td style={tdStyle}>{row.user}</td>
//                   <td style={tdStyle}>{row.fio}</td>
//                   <td style={tdStyle}>{row.kpiSum}</td>
//                   <td style={tdStyle}>{row.scheduleType}</td>
//                   <td style={tdStyle}>{row.department}</td>
//                   <td style={tdStyle}>{row.reason}</td>
//                   <td style={tdStyle}>
//                     <button
//                       type="button"
//                       onClick={() => handleRestore(row)}
//                       style={{
//                         ...actionBtnStyle,
//                         backgroundColor: "#dcfce7",
//                         color: "#166534",
//                       }}
//                     >
//                       –í–µ—Ä–Ω—É—Ç—å
//                     </button>
//                   </td>
//                 </tr>
//               ))}
//               {deletedLog.length === 0 && !loadingLogs && (
//                 <tr>
//                   <td style={{ ...tdStyle, padding: 12 }} colSpan={8}>
//                     –£–¥–∞–ª—ë–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –Ω–µ—Ç.
//                   </td>
//                 </tr>
//               )}
//             </tbody>
//           </table>
//         </div>
//       )}

//       {activeSubTab === "edited" && (
//         <div
//           style={{
//             marginTop: 4,
//             maxHeight: 420,
//             overflow: "auto",
//             border: "1px solid #e5e7eb",
//             borderRadius: 8,
//           }}
//         >
//           <table
//             style={{
//               width: "100%",
//               borderCollapse: "collapse",
//               fontSize: 11,
//             }}
//           >
//             <thead>
//               <tr style={{ backgroundColor: "#e5edf8" }}>
//                 <th style={thStyle}>–ö–æ–≥–¥–∞</th>
//                 <th style={thStyle}>–ö—Ç–æ</th>
//                 <th style={thStyle}>ID</th>
//                 <th style={thStyle}>–§–ò–û (—Å—Ç–∞—Ä.)</th>
//                 <th style={thStyle}>–§–ò–û (–Ω–æ–≤.)</th>
//                 <th style={thStyle}>–û—Ç–¥–µ–ª (—Å—Ç–∞—Ä.)</th>
//                 <th style={thStyle}>–û—Ç–¥–µ–ª (–Ω–æ–≤.)</th>
//                 <th style={thStyle}>–ì—Ä–∞—Ñ–∏–∫ (—Å—Ç–∞—Ä.)</th>
//                 <th style={thStyle}>–ì—Ä–∞—Ñ–∏–∫ (–Ω–æ–≤.)</th>
//                 <th style={thStyle}>KPI (—Å—Ç–∞—Ä.)</th>
//                 <th style={thStyle}>KPI (–Ω–æ–≤.)</th>
//               </tr>
//             </thead>
//             <tbody>
//               {editedLog.map((row, idx) => (
//                 <tr key={idx} style={{ borderTop: "1px solid #e5e7eb" }}>
//                   <td style={tdStyle}>{row.timestamp}</td>
//                   <td style={tdStyle}>{row.user}</td>
//                   <td style={tdStyle}>{row.id}</td>
//                   <td style={tdStyle}>{row.fio_old}</td>
//                   <td style={tdStyle}>{row.fio_new}</td>
//                   <td style={tdStyle}>{row.department_old}</td>
//                   <td style={tdStyle}>{row.department_new}</td>
//                   <td style={tdStyle}>{row.scheduleType_old}</td>
//                   <td style={tdStyle}>{row.scheduleType_new}</td>
//                   <td style={tdStyle}>{row.kpiSum_old}</td>
//                   <td style={tdStyle}>{row.kpiSum_new}</td>
//                 </tr>
//               ))}
//               {editedLog.length === 0 && !loadingLogs && (
//                 <tr>
//                   <td style={{ ...tdStyle, padding: 12 }} colSpan={11}>
//                     –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—É—Å—Ç–∞.
//                   </td>
//                 </tr>
//               )}
//             </tbody>
//           </table>
//         </div>
//       )}

//       {showAddModal && (
//         <Modal
//           onClose={() => {
//             setShowAddModal(false);
//             setAddConfirmMode(false);
//           }}
//         >
//           <h3 style={{ fontSize: 16, marginBottom: 8, color: COLOR_BLUE }}>
//             –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
//           </h3>
//           {!addConfirmMode ? (
//             <>
//               <p style={{ fontSize: 12, color: "#6b7280", marginTop: 0 }}>
//                 –£–∫–∞–∂–∏—Ç–µ –§–ò–û —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞{" "}
//                 <strong>–∫–∞–∫ –≤ —É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–∏ –ª–∏—á–Ω–æ—Å—Ç–∏ –∏–ª–∏ –≤ 1–°</strong>, –∞ —Ç–∞–∫–∂–µ
//                 –æ—Ç–¥–µ–ª–µ–Ω–∏–µ –∏ –≥—Ä–∞—Ñ–∏–∫ —Ä–∞–±–æ—Ç—ã.
//               </p>
//               <div style={{ display: "grid", gap: 8, fontSize: 13 }}>
//                 <TextInput
//                   label="–§–ò–û"
//                   value={addForm.fio}
//                   onChange={(v) => setAddForm({ ...addForm, fio: v })}
//                 />
//                 <NumberInput
//                   label="KPI —Å—É–º–º (—Ç–µ–Ω–≥–µ)"
//                   value={addForm.kpiSum}
//                   onChange={(v) => setAddForm({ ...addForm, kpiSum: v })}
//                 />
//                 <Select
//                   label="–ì—Ä–∞—Ñ–∏–∫"
//                   value={addForm.scheduleType}
//                   onChange={(v) =>
//                     setAddForm({ ...addForm, scheduleType: v })
//                   }
//                   options={[
//                     { value: "day", label: "–î–Ω–µ–≤–Ω–æ–π" },
//                     { value: "shift", label: "–°—É—Ç–æ—á–Ω—ã–π" },
//                   ]}
//                 />
//                 <TextInput
//                   label="–û—Ç–¥–µ–ª"
//                   value={addForm.department}
//                   onChange={(v) =>
//                     setAddForm({ ...addForm, department: v })
//                   }
//                 />
//                 <TextInput
//                   label="–ö–∞—Ç–µ–≥–æ—Ä–∏—è (–∫–æ–¥)"
//                   value={addForm.categoryCode}
//                   onChange={(v) =>
//                     setAddForm({ ...addForm, categoryCode: v })
//                   }
//                 />
//               </div>
//               <div
//                 style={{
//                   marginTop: 12,
//                   display: "flex",
//                   justifyContent: "flex-end",
//                   gap: 8,
//                 }}
//               >
//                 <button
//                   type="button"
//                   onClick={() => {
//                     setShowAddModal(false);
//                     setAddConfirmMode(false);
//                   }}
//                   style={secondaryBtn}
//                 >
//                   –û—Ç–º–µ–Ω–∞
//                 </button>
//                 <button
//                   type="button"
//                   onClick={handleAddSubmit}
//                   style={primaryBtn}
//                 >
//                   –î–∞–ª–µ–µ
//                 </button>
//               </div>
//             </>
//           ) : (
//             <>
//               <p style={{ fontSize: 13, color: "#111827" }}>
//                 –ü–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º:
//               </p>
//               <ul style={{ fontSize: 13, paddingLeft: 18 }}>
//                 <li>
//                   <strong>–§–ò–û:</strong> {addForm.fio}
//                 </li>
//                 <li>
//                   <strong>KPI —Å—É–º–º:</strong> {addForm.kpiSum}
//                 </li>
//                 <li>
//                   <strong>–ì—Ä–∞—Ñ–∏–∫:</strong>{" "}
//                   {addForm.scheduleType === "day" ? "–î–Ω–µ–≤–Ω–æ–π" : "–°—É—Ç–æ—á–Ω—ã–π"}
//                 </li>
//                 <li>
//                   <strong>–û—Ç–¥–µ–ª:</strong> {addForm.department}
//                 </li>
//                 <li>
//                   <strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> {addForm.categoryCode}
//                 </li>
//               </ul>
//               <p style={{ fontSize: 12, color: "#6b7280" }}>
//                 –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è KPI –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑
//                 –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏.
//               </p>
//               <div
//                 style={{
//                   marginTop: 12,
//                   display: "flex",
//                   justifyContent: "flex-end",
//                   gap: 8,
//                 }}
//               >
//                 <button
//                   type="button"
//                   onClick={() => setAddConfirmMode(false)}
//                   style={secondaryBtn}
//                 >
//                   –ù–∞–∑–∞–¥
//                 </button>
//                 <button
//                   type="button"
//                   onClick={handleAddConfirm}
//                   style={primaryBtn}
//                 >
//                   –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å
//                 </button>
//               </div>
//             </>
//           )}
//         </Modal>
//       )}

//       {editItem && editForm && (
//         <Modal
//           onClose={() => {
//             setEditItem(null);
//             setEditForm(null);
//           }}
//         >
//           <h3 style={{ fontSize: 16, marginBottom: 8, color: COLOR_BLUE }}>
//             –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
//           </h3>
//           <p style={{ fontSize: 12, color: "#6b7280", marginTop: 0 }}>
//             –ú–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –§–ò–û, –æ—Ç–¥–µ–ª –∏ –≥—Ä–∞—Ñ–∏–∫. KPI —Å—É–º–º –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è
//             —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º.
//           </p>
//           <div style={{ display: "grid", gap: 8, fontSize: 13 }}>
//             <TextInput
//               label="–§–ò–û"
//               value={editForm.fio}
//               onChange={(v) => setEditForm({ ...editForm, fio: v })}
//             />
//             <NumberInput
//               label="KPI —Å—É–º–º (—Ç–µ–Ω–≥–µ)"
//               value={editForm.kpiSum}
//               onChange={(v) => setEditForm({ ...editForm, kpiSum: v })}
//               disabled={!isAdmin}
//             />
//             <Select
//               label="–ì—Ä–∞—Ñ–∏–∫"
//               value={editForm.scheduleType}
//               onChange={(v) =>
//                 setEditForm({ ...editForm, scheduleType: v })
//               }
//               options={[
//                 { value: "day", label: "–î–Ω–µ–≤–Ω–æ–π" },
//                 { value: "shift", label: "–°—É—Ç–æ—á–Ω—ã–π" },
//               ]}
//             />
//             <TextInput
//               label="–û—Ç–¥–µ–ª"
//               value={editForm.department}
//               onChange={(v) =>
//                 setEditForm({ ...editForm, department: v })
//               }
//             />
//             <TextInput
//               label="–ö–∞—Ç–µ–≥–æ—Ä–∏—è (–∫–æ–¥)"
//               value={editForm.categoryCode}
//               onChange={(v) =>
//                 setEditForm({ ...editForm, categoryCode: v })
//               }
//             />
//           </div>
//           <div
//             style={{
//               marginTop: 12,
//               display: "flex",
//               justifyContent: "flex-end",
//               gap: 8,
//             }}
//           >
//             <button
//               type="button"
//               onClick={() => {
//                 setEditItem(null);
//                 setEditForm(null);
//               }}
//               style={secondaryBtn}
//             >
//               –û—Ç–º–µ–Ω–∞
//             </button>
//             <button
//               type="button"
//               onClick={handleEditSave}
//               style={primaryBtn}
//             >
//               –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
//             </button>
//           </div>
//         </Modal>
//       )}

//       {deleteItem && (
//         <Modal
//           onClose={() => {
//             setDeleteItem(null);
//             setDeleteReason("—É–≤–æ–ª–∏–ª—Å—è");
//             setDeleteOther("");
//           }}
//         >
//           <h3 style={{ fontSize: 16, marginBottom: 8, color: "#b91c1c" }}>
//             –£–¥–∞–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
//           </h3>
//           <p style={{ fontSize: 13 }}>
//             –í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞{" "}
//             <strong>{deleteItem.fio}</strong> –∏–∑ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ KPI?
//           </p>
//           <p style={{ fontSize: 12, color: "#6b7280" }}>
//             –£–∫–∞–∂–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É —É–¥–∞–ª–µ–Ω–∏—è ‚Äî –æ–Ω–∞ –±—É–¥–µ—Ç –∑–∞–ø–∏—Å–∞–Ω–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π
//             Excel-–ª–æ–≥.
//           </p>
//           <div style={{ display: "grid", gap: 8, fontSize: 13 }}>
//             <label style={{ fontSize: 13 }}>
//               –ü—Ä–∏—á–∏–Ω–∞:
//               <select
//                 value={deleteReason}
//                 onChange={(e) => setDeleteReason(e.target.value)}
//                 style={{
//                   marginTop: 4,
//                   width: "100%",
//                   padding: 6,
//                   borderRadius: 8,
//                   border: "1px solid #d1d5db",
//                 }}
//               >
//                 <option value="—É–≤–æ–ª–∏–ª—Å—è">–£–≤–æ–ª–∏–ª—Å—è</option>
//                 <option value="–¥–æ–±–∞–≤–ª–µ–Ω_—Å–ª—É—á–∞–π–Ω–æ">
//                   –î–æ–±–∞–≤–ª–µ–Ω(–∞) —Å–ª—É—á–∞–π–Ω–æ
//                 </option>
//                 <option value="–¥—Ä—É–≥–æ–µ">–î—Ä—É–≥–æ–µ</option>
//               </select>
//             </label>
//             {deleteReason === "–¥—Ä—É–≥–æ–µ" && (
//               <TextInput
//                 label="–î—Ä—É–≥–∞—è –ø—Ä–∏—á–∏–Ω–∞"
//                 value={deleteOther}
//                 onChange={(v) => setDeleteOther(v)}
//               />
//             )}
//           </div>
//           <div
//             style={{
//               marginTop: 12,
//               display: "flex",
//               justifyContent: "flex-end",
//               gap: 8,
//             }}
//           >
//             <button
//               type="button"
//               onClick={() => {
//                 setDeleteItem(null);
//                 setDeleteReason("—É–≤–æ–ª–∏–ª—Å—è");
//                 setDeleteOther("");
//               }}
//               style={secondaryBtn}
//             >
//               –û—Ç–º–µ–Ω–∞
//             </button>
//             <button
//               type="button"
//               onClick={handleDeleteConfirm}
//               style={{ ...primaryBtn, backgroundColor: "#b91c1c" }}
//             >
//               –£–¥–∞–ª–∏—Ç—å
//             </button>
//           </div>
//         </Modal>
//       )}
//     </div>
//   );
// }

// function Modal({ children, onClose }) {
//   return (
//     <div
//       style={{
//         position: "fixed",
//         inset: 0,
//         backgroundColor: "rgba(15,23,42,0.45)",
//         display: "flex",
//         alignItems: "center",
//         justifyContent: "center",
//         zIndex: 50,
//       }}
//     >
//       <div
//         style={{
//           position: "relative",
//           backgroundColor: COLOR_CARD,
//           padding: 20,
//           borderRadius: 16,
//           boxShadow: "0 24px 60px rgba(0,0,0,0.3)",
//           width: "min(480px, 90vw)",
//           maxHeight: "80vh",
//           overflowY: "auto",
//         }}
//       >
//         {children}
//         <button
//           type="button"
//           onClick={onClose}
//           style={{
//             position: "absolute",
//             top: 10,
//             right: 12,
//             border: "none",
//             background: "transparent",
//             cursor: "pointer",
//             fontSize: 18,
//             color: "#6b7280",
//           }}
//         >
//           √ó
//         </button>
//       </div>
//     </div>
//   );
// }

// function TextInput({ label, value, onChange }) {
//   return (
//     <label style={{ fontSize: 13 }}>
//       {label}
//       <input
//         type="text"
//         value={value}
//         onChange={(e) => onChange(e.target.value)}
//         style={{
//           marginTop: 4,
//           width: "100%",
//           padding: 6,
//           borderRadius: 8,
//           border: "1px solid #d1d5db",
//         }}
//       />
//     </label>
//   );
// }

// function NumberInput({ label, value, onChange, disabled }) {
//   return (
//     <label style={{ fontSize: 13 }}>
//       {label}
//       <input
//         type="number"
//         value={value}
//         disabled={disabled}
//         onChange={(e) => onChange(Number(e.target.value))}
//         style={{
//           marginTop: 4,
//           width: "100%",
//           padding: 6,
//           borderRadius: 8,
//           border: "1px solid #d1d5db",
//           backgroundColor: disabled ? "#f9fafb" : "white",
//         }}
//       />
//     </label>
//   );
// }

// function Select({ label, value, onChange, options }) {
//   return (
//     <label style={{ fontSize: 13 }}>
//       {label}
//       <select
//         value={value}
//         onChange={(e) => onChange(e.target.value)}
//         style={{
//           marginTop: 4,
//           width: "100%",
//           padding: 6,
//           borderRadius: 8,
//           border: "1px solid #d1d5db",
//         }}
//       >
//         {options.map((opt) => (
//           <option key={opt.value} value={opt.value}>
//             {opt.label}
//           </option>
//         ))}
//       </select>
//     </label>
//   );
// }

// const thStyle = {
//   padding: "6px 8px",
//   textAlign: "left",
//   borderBottom: "1px solid #e5e7eb",
//   position: "sticky",
//   top: 0,
//   backgroundColor: "#e5edf8",
//   zIndex: 1,
// };

// const tdStyle = {
//   padding: "4px 8px",
//   textAlign: "left",
//   whiteSpace: "nowrap",
// };

// const primaryBtn = {
//   padding: "8px 14px",
//   borderRadius: 999,
//   border: "none",
//   backgroundColor: COLOR_BLUE,
//   color: "white",
//   fontSize: 13,
//   cursor: "pointer",
// };

// const secondaryBtn = {
//   padding: "8px 14px",
//   borderRadius: 999,
//   border: "1px solid #d1d5db",
//   backgroundColor: "white",
//   color: "#374151",
//   fontSize: 13,
//   cursor: "pointer",
// };

// const actionBtnStyle = {
//   padding: "4px 8px",
//   borderRadius: 999,
//   border: "none",
//   backgroundColor: "#e5e7eb",
//   color: "#111827",
//   fontSize: 11,
//   cursor: "pointer",
//   marginRight: 4,
// };

// const subTabBtnStyle = {
//   padding: "6px 10px",
//   borderRadius: 999,
//   border: "1px solid #e5e7eb",
//   backgroundColor: "white",
//   cursor: "pointer",
// };

// const subTabBtnActive = {
//   backgroundColor: "#e0f2fe",
//   borderColor: "#93c5fd",
// };

// export default App;